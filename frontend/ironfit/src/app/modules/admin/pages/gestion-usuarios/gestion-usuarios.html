<div class="usuarios-layout">

    <header class="usuarios-header">
        <div class="usuarios-header-left">
            <button class="btn-volver" (click)="volverAlDashboard()">‚Üê Volver</button>
            <h1>Gesti√≥n de usuarios</h1>
        </div>

        <div class="usuarios-header-right">
            <!-- CAMPO DE B√öSQUEDA -->
            <div class="busqueda-container">
                <input 
                    type="text" 
                    class="input-busqueda" 
                    placeholder="üîç Buscar por c√©dula o nombre..."
                    [(ngModel)]="terminoBusqueda"
                    (input)="aplicarFiltros()">
            </div>

            <div class="usuarios-filtros" *ngIf="filtroTipo || filtroEstado">
                <span>
                    Filtrando:
                    <strong *ngIf="filtroTipo">{{ filtroTipo | titlecase }}s</strong>
                    <span *ngIf="filtroEstado"> ({{ filtroEstado | lowercase }})</span>
                </span>
            </div>

            <!-- BOT√ìN NUEVO USUARIO -->
            <button
                *ngIf="!vieneDeDashboard"
                class="btn-crear-usuario"
                (click)="abrirFormularioCrear()">
                + Nuevo usuario
            </button>
        </div>
    </header>

    <!-- FORMULARIO CREAR USUARIO (fuera del header) -->
    <section *ngIf="mostrarFormularioCrear" class="crear-usuario-form">
    <h2>Crear nuevo usuario</h2>

    <form (ngSubmit)="guardarUsuario()">
        <div class="form-row">
        <label>Tipo documento</label>
        <select [(ngModel)]="nuevoUsuario.tipoDoc" name="tipoDoc">
            <option value="CC">C√©dula</option>
            <option value="TI">Tarjeta de identidad</option>
        </select>
        </div>

        <div class="form-row">
        <label>N√∫mero documento</label>
        <input type="text" [(ngModel)]="nuevoUsuario.nroDoc" name="nroDoc" required>
        </div>

        <div class="form-row">
        <label>Nombres</label>
        <input type="text" [(ngModel)]="nuevoUsuario.nombres" name="nombres" required>
        </div>

        <div class="form-row">
        <label>Apellidos</label>
        <input type="text" [(ngModel)]="nuevoUsuario.apellidos" name="apellidos" required>
        </div>

        <div class="form-row">
        <label>Email</label>
        <input type="email" [(ngModel)]="nuevoUsuario.email" name="email">
        </div>

        <div class="form-row">
        <label>Tel√©fono</label>
        <input type="text" [(ngModel)]="nuevoUsuario.telefono" name="telefono">
        </div>

        <div class="form-row">
        <label>Activo</label>
        <input type="checkbox" [(ngModel)]="nuevoUsuario.activo" name="activo">
        </div>

        <div class="form-row">
        <label>Rol</label>
        <select [(ngModel)]="nuevoUsuario.rol" name="rol">
            <option value="CLIENTE">Cliente</option>
            <option value="ENTRENADOR">Entrenador</option>
            <option value="ADMIN">Administrador</option>
        </select>
        </div>

        <div class="form-actions">
        <button type="submit">Guardar</button>
        <button type="button" (click)="cancelarCrear()">Cancelar</button>
        </div>
    </form>
</section>



    <!-- LOADER -->
    <section *ngIf="cargando">
        <p>Cargando usuarios...</p>
    </section>

    <!-- TABLA -->
    <section *ngIf="!cargando">
        <table class="usuarios-tabla" *ngIf="usuariosFiltrados.length > 0; else noHayUsuarios">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>C√©dula</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Email</th>
                    <th>Tel√©fono</th>
                    <th>Activo</th>
                    <th>Roles</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let u of usuariosFiltrados">
                    <td>{{ u.idUsuario }}</td>
                    <td>{{ u.nroDoc }}</td>
                    <td>{{ u.nombres }}</td>
                    <td>{{ u.apellidos }}</td>
                    <td>{{ u.email || '-' }}</td>
                    <td>{{ u.telefono || '-' }}</td>
                    <td>
                        <span class="estado-badge" [class.activo]="u.activo">
                            {{ u.activo ? 'Activo' : 'Inactivo' }}
                        </span>
                    </td>
                    <td>{{ u.roles && u.roles.length ? u.roles.join(', ') : '-' }}</td>
                </tr>
            </tbody>
        </table>

        <ng-template #noHayUsuarios>
            <p>No hay usuarios que coincidan con los filtros{{ terminoBusqueda ? ' o la b√∫squeda' : '' }}.</p>
        </ng-template>
    </section>

</div>
