<div class="planes-layout">

    <!-- ENCABEZADO -->
    <header class="planes-header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <button class="btn-volver" (click)="volverAlDashboard()">‚Üê Volver</button>
            <h1>Planes de entrenamiento</h1>
        </div>
        
        <!-- CAMPO DE B√öSQUEDA (solo visible cuando NO se est√°n viendo rutinas) -->
        <div class="busqueda-container" *ngIf="!showingRutinas">
            <input 
                type="text" 
                class="input-busqueda" 
                placeholder="üîç Buscar por plan, cliente o entrenador..."
                [(ngModel)]="terminoBusqueda"
                (input)="aplicarFiltrosPlanes()">
        </div>
    </header>

    <!-- CARGANDO -->
    <section *ngIf="cargando">
        <p>Cargando...</p>
    </section>

    <section *ngIf="!cargando">

        <!-- ============================= -->
        <!--    VISTA: RUTINAS DEL PLAN    -->
        <!-- ============================= -->
        <section *ngIf="showingRutinas">

            <div style="display:flex;align-items:center;gap:1rem;margin-bottom:0.5rem;">
                <button class="btn-volver" (click)="volverAListaPlanes()">‚Üê Volver a planes</button>
                <h2 style="margin:0">Rutinas del plan</h2>
            </div>
            
            <!-- CAMPO DE B√öSQUEDA PARA RUTINAS -->
            <div class="busqueda-container" style="margin-bottom: 1rem;">
                <input 
                    type="text" 
                    class="input-busqueda" 
                    placeholder="üîç Buscar rutina..."
                    [(ngModel)]="terminoBusqueda"
                    (input)="aplicarFiltrosRutinas()">
            </div>

            <!-- TABLA DE RUTINAS -->
            <table class="planes-tabla" *ngIf="rutinasFiltradas.length > 0; else noHayRutinas">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre de rutina</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let r of rutinasFiltradas">
                        <td>{{ r.idRutina }}</td>
                        <td>{{ r.nombre }}</td>
                        <td>{{ r.descripcion || '‚Äî' }}</td>
                    </tr>
                </tbody>
            </table>

            <!-- MENSAJE: SIN RUTINAS -->
            <ng-template #noHayRutinas>
                <p>No hay rutinas asociadas a este plan.</p>
            </ng-template>

        </section>


        <!-- ============================= -->
        <!--   TABLA PRINCIPAL DE PLANES   -->
        <!-- ============================= -->
        <table class="planes-tabla" *ngIf="planesFiltrados.length > 0 && !showingRutinas; else noHayPlanes">

            <thead>
                <tr>
                    <th>ID</th>
                    <th>Plan</th>
                    <th>Cliente</th>
                    <th>Entrenador</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let p of planesFiltrados">
                    <td>{{ p.idPlan }}</td>
                    <td>{{ p.nombrePlan }}</td>
                    <td>{{ p.nombreCliente }}</td>
                    <td>{{ p.nombreEntrenador }}</td>
                    <td>{{ p.fechaInicio }}</td>
                    <td>{{ p.fechaFin }}</td>
                    <td>
                        <span class="estado-badge" [class.activo]="p.estado === 'ACTIVO'">
                            {{ p.estado }}
                        </span>
                    </td>
                    <td>
                        <button class="btn-accion" (click)="verRutina(p.idPlan)">
                            Ver rutinas
                        </button>
                    </td>
                </tr>
            </tbody>

        </table>

        <!-- MENSAJE: SIN PLANES -->
        <ng-template #noHayPlanes>
            <p>No hay planes de entrenamiento registrados.</p>
        </ng-template>

    </section>

</div>

