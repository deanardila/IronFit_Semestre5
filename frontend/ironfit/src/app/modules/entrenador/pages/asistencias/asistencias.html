<div class="asistencias-layout">
	<header class="asistencias-header">
		<div class="asistencias-header-left">
			<button class="btn-volver" (click)="volver()">â† Volver</button>
			<h1>Sesiones cumplidas</h1>
		</div>
		<div class="asistencias-header-right">
			<div class="busqueda-container">
				<input
					type="text"
					class="input-busqueda"
					placeholder="ğŸ” Buscar cliente o plan..."
					[(ngModel)]="terminoBusqueda"
					(input)="aplicarFiltros()" />
			</div>
			<span class="asistencias-filtros" *ngIf="terminoBusqueda">Filtrando: "{{ terminoBusqueda }}"</span>
			<button class="btn-actualizar" (click)="actualizar()">ğŸ”„ Actualizar</button>
		</div>
	</header>

	<section *ngIf="cargando"><p>Cargando asistencias...</p></section>
	<section *ngIf="!cargando && error"><p>{{ error }}</p></section>

	<section *ngIf="!cargando && !error">
		<table class="asistencias-tabla" *ngIf="asistenciasFiltradas.length > 0; else noAsistencias">
			<thead>
				<tr>
					<th>Cliente</th>
					<th>Plan</th>
					<th>Sesiones Plan</th>
					<th>Asistidas</th>
					<th>% Asistencia</th>
					<th>Completas</th>
					<th>% Completas</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let r of asistenciasFiltradas">
					<td>{{ r.nombreCliente }}</td>
					<td>{{ r.nombrePlan }}</td>
					<td>{{ r.totalSesionesPlan }}</td>
					<td>{{ r.sesionesAsistidas }}</td>
					<td>
						<span class="pct-badge"
							[class.alto]="r.porcentajeAsistencia >= 80"
							[class.medio]="r.porcentajeAsistencia >= 50 && r.porcentajeAsistencia < 80"
							[class.bajo]="r.porcentajeAsistencia < 50">
							{{ r.porcentajeAsistencia | number:'1.0-1' }}%
						</span>
					</td>
					<td>{{ r.sesionesCompletas }}</td>
					<td>
						<span class="pct-badge"
							[class.alto]="r.porcentajeCompletas >= 80"
							[class.medio]="r.porcentajeCompletas >= 50 && r.porcentajeCompletas < 80"
							[class.bajo]="r.porcentajeCompletas < 50">
							{{ r.porcentajeCompletas | number:'1.0-1' }}%
						</span>
					</td>
				</tr>
			</tbody>
		</table>
		<ng-template #noAsistencias>
			<p>No hay registros de sesiones cumplidas.</p>
		</ng-template>
	</section>
</div>
